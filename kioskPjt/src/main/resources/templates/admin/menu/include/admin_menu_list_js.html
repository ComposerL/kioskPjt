<script th:fragment="js" type="text/javascript">



$(document).ready(function() {
    // 페이지가 로드되면 카테고리와 메뉴들을 가져오는 함수 호출
    ajax_getCategorie_menu();
    ajax_get_all_menus();

    // 카테고리 버튼을 클릭하면 해당 카테고리의 메뉴를 출력하는 함수 호출
    $(document).on('click', '.menu_category_change_wrap a', function(e) {
        e.preventDefault(); // 기본 이벤트 방지
        ajax_get_menus_by_category(this.getAttribute('value')); // 해당 카테고리의 메뉴 출력 함수 호출
    });
});

// 모든 카테고리 가져오기
function ajax_getCategorie_menu() {
    $.ajax({
        url: '/admin/menu/getCategory',
        method: 'post',
        contentType: 'application/json; charset=utf-8',
        dataType: 'json',
        success: function(data) {
            let cateDtos = data.categoryDtos;
            for (let i = 0; i < cateDtos.length; i++) {
                // 카테고리 버튼 추가
                
                $('.menu_category_change_wrap').append('<input type="hidden" id="csrfToken" th:value="${_csrf.token}"/>');
                $('.menu_category_change_wrap').append('<a href="#" value="' + cateDtos[i].fcmc_no + '">' + cateDtos[i].fcmc_name + '</a>');
            
            }
        },
        error: function(data) {
            console.log('ajax error!!');
        }
    });
}

// 모든 메뉴 가져오기
function ajax_get_all_menus() {
    $.ajax({
        url: '/admin/menu/getMenus',
        method: 'post',
        contentType: 'application/json; charset=utf-8',
        dataType: 'json',
        success: function(data) {
            // 메뉴 출력 함수 호출
            renderMenus(data.menusDtos);
        },
        error: function(data) {
            console.log('ajax error!!');
        }
    });
}

// 카테고리에 따른 메뉴 가져오기
function ajax_get_menus_by_category(fcmc_no) {
	console.log('ajax_get_menus_by_category()');
	console.log(fcmc_no);
	
    $.ajax({
        url: '/admin/menu/getMenusByCategory',
        method: 'post',
       /*  beforeSend: function(xhr) {
            xhr.setRequestHeader("X-CSRF-TOKEN", $('#csrfToken').val());
        }, */
        data: ({ 'fcmc_no': fcmc_no }),	// 컨트롤러로 보낼 때 타입
       // contentType: 'application/json; charset=utf-8',	// 파라미터의 타입
       dataType: 'json',							// ?? 공부하기
        success: function(data) {
        	console.log('ajsx sucess!!')
            // 메뉴 출력 함수 호출
            renderMenus(data.menusDtos);
        },
        error: function(data) {
            console.log('ajax error!!');
        }
    });
}

// 메뉴 출력 함수
function renderMenus(menusDtos) {
    let appendTag = '';
    let itemsPerRow = 4; // 한 행당 아이템 개수
    for (let i = 0; i < menusDtos.length; i += itemsPerRow) {
        appendTag += '<tr>'; // 새로운 행을 시작합니다.
        // 한 행에 최대 itemsPerRow 개의 아이템을 추가합니다.
        for (let j = 0; j < itemsPerRow; j++) {
            let index = i + j; // 현재 아이템 인덱스
            if (index < menusDtos.length) {
                appendTag += '<td>';
                appendTag += '<div class="menu_item_wrap">';
                appendTag += '<ul>';
                appendTag += '<li class="fc_menu_img_name">';
                appendTag += '<img src="http://14.42.124.93:8091/kioskUploadImg/' + menusDtos[index].fc_menu_img_name + '">';
                appendTag += '</li>';
                appendTag += '<li class="fc_menu_name">';
                appendTag += menusDtos[index].fc_menu_name;
                appendTag += '</li>';
                appendTag += '</ul>';
                appendTag += '</div>';
                appendTag += '</td>';
            } else {
                appendTag += '<td></td>'; // 남은 셀을 빈 셀로 채웁니다.
            }
        }
        appendTag += '</tr>'; // 행을 마감합니다.
    }
    $('#admin_menu_list').html(appendTag);
}





</script>
