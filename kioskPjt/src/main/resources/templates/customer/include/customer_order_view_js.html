
<script th:fragment="customer_order_view_js" type="text/javascript">

let cart = {};

let innerCartSlideMoveValue = 120;
let leftMovedCount = 0;	
let rightMovedCount = 0;

$(document).ready(function() {
	
	init();
		
});

function init(){
	
	eventsHandler();
	
}

function eventsHandler(){
	
	
	// (수정) 메뉴 선택완료 버튼 클릭시 카트에 담기게 + 모달창 닫기
	$(".select_oreder input[name='select']").click(function(){
		console.log("select btn click!!!");
		
		// 메뉴 no
		let fc_menu_no = $("div.header_sec p.menu_no").text();
		
		// 메뉴 카테고리 no
		let fcmc_no = $("div.header_sec p.menu_category").text();
		
		// 메뉴 img URL
		let fc_menu_img = $("div.header_sec img.img_section").attr("src");
		
		// 선택 메뉴 한 잔 당 가격 (기본메뉴가격 * 1)
		let fc_menu_price = $('div.modal_header p.menu_price_origin').text();
		
		// 메뉴 커스텀 후 한 잔 당 가격((기본메뉴가격 * 1) + (옵션1가격 * 옵션추가수) + (옵션2가격 * 옵션추가수))
		let fc_menu_price_one = $('div.modal_header p.menu_price_one').text();
		
		// 메뉴 토탈 가격
		let fco_total_price = $('div.modal_header p.menu_price').text();
		
		// 메뉴 카운트
		let fc_menu_cnt = $('div.modal_header p.menu_number').text();
		
		// 샷 추가 갯수
		let shot_number = $('div.euro_option p.shot_number').text();
		
		// 샷 가격 (샷 가격 * 샷 추가수)
		let shot_price = shot_number * 500;
		
		// 펄 추가 갯수
		let pur_number = $('div.euro_option p.pur_number').text();
		
		// 펄 가격 (펄 가격 * 펄 추가수)
		let pur_price = pur_number * 1000;
		
		// 카트에 담는 함수 호출
		
		if($("ul.cart_area_items li").length !== 0){
			console.log("$('ul.cart_area_items li').length !== 0");
			
			for(let i = 0; i < $("ul.cart_area_items li").length; i++){
				console.log("for for for");
				
				if($("ul.cart_area_items li").eq(i).attr('id').replace("cart_item_", "") === fc_menu_no+shot_number+pur_number){
					console.log("same menu");
										
					let item_cnt = parseInt($("ul.cart_area_items li").eq(i).children('div.cart_item_select_wrap').children('p.fco_menu_cnt').text());
					let fc_menu_price_one = parseInt($("ul.cart_area_items li").eq(i).children('div.cart_item_select_wrap').children('input[name="fc_menu_price_one"]').val());
					let add_item_cnt = parseInt($("div.modal_header p.menu_number").text());
					
					console.log("fc_menu_price_one: "+fc_menu_price_one);
					if(item_cnt >= 20){
						item_cnt = 20;
					}else{
						item_cnt += add_item_cnt;
					}
					$("ul.cart_area_items li").eq(i).children('div.cart_item_select_wrap').children('p.fco_menu_cnt').text(item_cnt);
					
					$("ul.cart_area_items li").eq(i).children('div.cart_item_select_wrap').children('input[name="fco_total_price"]').val(item_cnt*fc_menu_price_one);
					
					totalPriceCalculator();
					
					$("#myModal").fadeOut();
			        resetValues();
					
					return;
				}else{
					continue;
				}
				
			}// for(let i = 0; i < $("ul.cart_area_items li").length; i++)
			addCartItem(fc_menu_img, fc_menu_price, fc_menu_no, fc_menu_cnt, fc_menu_price_one, fcmc_no, 
					shot_number, shot_price, pur_number, pur_price, fco_total_price);
			
		}else{
			console.log("1번 fc_menu_price_one: ",fc_menu_price_one);
			addCartItem(fc_menu_img, fc_menu_price, fc_menu_no, fc_menu_cnt, fc_menu_price_one, fcmc_no, 
					shot_number, shot_price, pur_number, pur_price, fco_total_price);
		}
		// 모달창 닫히고 모달창의 value 초기화
		$("#myModal").fadeOut();
        resetValues();
		
	});
	
	//오더 전체 취소 버튼 클릭
	$('#footer_wrap div.price_area_wrap div.order_cancel_btn').click(function(){
		console.log("order_cancel_btn click!!!");
		
		removeCartItem();
		totalPriceCalculator();
		//cart slide 값 초기화
		innerCartSlideMoveValue = 120;
		leftMovedCount = 0;	
		rightMovedCount = 0;
	});
	
	//장바구니 슬라이드 영역
	$('#footer_wrap div.cart_area_right_btn').click(function(){
		console.log("cart_area_right_btn click!!!");				
		let innerCartItemCnt = $('#footer_wrap ul.cart_area_items li').length;
		let canMoveCount = innerCartItemCnt - 5;
			
		if(innerCartItemCnt > 5){
			
			if((canMoveCount - leftMovedCount) > 0){
				leftMovedCount += 1;
				
				$('#footer_wrap ul.cart_area_items').animate({
						
					'left' : -(innerCartSlideMoveValue * leftMovedCount)+'px'
					
				},300);
				rightMovedCount -= 1;
				console.log("rightMovedCount: "+rightMovedCount);							
			}			
				
		}//if(innerCartItemCnt > 5)
						
	});//$('#footer_wrap div.cart_area_right_btn').click
	
	$('#footer_wrap div.cart_area_left_btn').click(function(){
		console.log("cart_area_left_btn click!!!");				
		let innerCartItemCnt = $('#footer_wrap ul.cart_area_items li').length;
		let canMoveCount = innerCartItemCnt - 5;
			
		if(innerCartItemCnt > 5){
			
			if((canMoveCount - leftMovedCount) < canMoveCount){
				leftMovedCount -= 1;
				
				$('#footer_wrap ul.cart_area_items').animate({
						
					'left' : (innerCartSlideMoveValue * (rightMovedCount+1))+'px'
					
				},300);
				rightMovedCount += 1;
			}			
				
		}//if(innerCartItemCnt > 5)
						
	});//$('#footer_wrap div.cart_area_right_btn').click
	
}

function removeCartItem(){
	console.log("removeCartItem()");
	
	$("ul.cart_area_items").empty();
}


function totalPriceCalculator(){
	let total_menu_price = 0;
	$("div.total_price_text h4 span").empty();
	for(let i = 0; i < $("ul.cart_area_items li input[name='fc_menu_price']").length; i++){
		
		fc_menu_price = parseInt($("ul.cart_area_items li input[name='fco_total_price']").eq(i).val().replace("\\", ""));
		
		total_menu_price += fc_menu_price;
	}
	
	$("div.total_price_text h4 span").text(total_menu_price);
}


//footer cart area
function addCartItem(menu_img, fc_menu_price, menu_no, fco_menu_cnt, fc_menu_price_one, fcmc_no,
		shot_number, shot_price, pur_number, pur_price, fco_total_price){
	console.log("addCartItem()");
	/*
	let fco_menu_cnt = 1;
	*/
	let appendTag = "";
	let cartItemID = menu_no + shot_number + pur_number;
	appendTag = '<li id="cart_item_'+cartItemID+'">';
		appendTag += '<img class="cart_area_cancel_btn" src="/img/home/cart_area_cancel_btn.png" alt="">';
		appendTag += '<div class="cart_item_img"><img src="'+menu_img+'" alt=""></div>'
		appendTag += '<div class="cart_item_select_wrap">';
		
			appendTag += '<div class="item_sub_btn" ><img src="/img/home/cart_area_sub_btn.png" alt=""></div>';
			appendTag += '<p class="fco_menu_cnt">'+fco_menu_cnt+'</p>';
			appendTag += '<div class="item_add_btn" menu_no='+menu_no+'><img src="/img/home/cart_area_add_btn.png" alt=""></div>';
			appendTag += '<input type="hidden" name="fc_menu_no" value="'+menu_no+'">';
			appendTag += '<input type="hidden" name="fcmc_no" value="'+fcmc_no+'">';
			/* appendTag += '<input type="hidden" name="fco_packaging" value="'+fco_packaging+'">'; */
			appendTag += '<input type="hidden" name="fc_menu_price" value="'+fc_menu_price+'">';
			appendTag += '<input type="hidden" name="fco_total_price" value="'+fco_total_price+'">';
			appendTag += '<input type="hidden" name="fc_menu_price_one" value="'+fc_menu_price_one+'">';
			appendTag += '<input type="hidden" name="shot_number" value="'+shot_number+'">';
			appendTag += '<input type="hidden" name="shot_price" value="'+shot_price+'">';
			appendTag += '<input type="hidden" name="pur_number" value="'+pur_number+'">';
			appendTag += '<input type="hidden" name="pur_price" value="'+pur_price+'">';
			
		appendTag += '</div>';
	appendTag += '</li>';
	
	$("ul.cart_area_items").append(appendTag);
	
	totalPriceCalculator();
	
	//장바구니 특정 아이템 삭제 버튼 클릭
	$("#cart_item_" + cartItemID + " img.cart_area_cancel_btn").click(function(){
		console.log("cart_area_cancel_btn click!!!");
		$(this).parent('li').remove();
		totalPriceCalculator();
		
		let innerCartItemCnt = $('#footer_wrap ul.cart_area_items li').length;
		let canMoveCount = innerCartItemCnt - 5;
			
		if(innerCartItemCnt >= 5){
			
			if((canMoveCount - leftMovedCount) < canMoveCount){
				leftMovedCount -= 1;
				
				$('#footer_wrap ul.cart_area_items').animate({
						
					'left' : (innerCartSlideMoveValue * (rightMovedCount+1))+'px'
					
				},300);
				rightMovedCount += 1;
			}			
				
		}//if(innerCartItemCnt > 5)
				
	});
	//장바구니 특정 아이템 +버튼 클릭
	$("#cart_item_" + cartItemID + " div.cart_item_select_wrap div.item_add_btn").click(function(e){
		console.log("item_add_btn click!!!");
							
			let item_cnt = parseInt($(this).siblings('p.fco_menu_cnt').text());
			let fc_menu_price = parseInt($(this).siblings('input[name="fc_menu_price"]').val());
			
			if(item_cnt >= 20){
				item_cnt = 20;
			}else{
				item_cnt += 1;
			}
			$(this).siblings('p.fco_menu_cnt').text(item_cnt);
			
			$(this).siblings('input[name="fco_total_price"]').val(item_cnt*fc_menu_price_one);
			
			totalPriceCalculator();
		
	});
	//장바구니 특정 아이템 -버튼 클릭
	$("#cart_item_" + cartItemID + " div.cart_item_select_wrap div.item_sub_btn").click(function(){
		console.log("item_sub_btn click!!!");
		let item_cnt = parseInt($(this).siblings('p.fco_menu_cnt').text());
		let fc_menu_price_one = parseInt($(this).siblings('input[name="fc_menu_price_one"]').val());
		
		if(item_cnt <= 1){
			item_cnt = 1;
		}else{
			item_cnt -= 1;
		}
		$(this).siblings('p.fco_menu_cnt').text(item_cnt);
		
		$(this).siblings('input[name="fco_total_price"]').val(item_cnt*fc_menu_price_one);
		
		totalPriceCalculator();
	});
			
	//결제하기 버튼 클릭
	/* $("#footer_wrap div.price_area_wrap div.payment_btn").click(function(){
		console.log("payment_btn click!!!");
		
		let fco_menu_cnt = parseInt($("#footer_wrap div.cart_area_wrap ul.cart_area_items li p.fco_menu_cnt").text());
		let fc_menu_no = parseInt($("#footer_wrap div.cart_area_wrap ul.cart_area_items li input[name='fc_menu_no']").val());
		let fcmc_no = parseInt($("#footer_wrap div.cart_area_wrap ul.cart_area_items li input[name='fcmc_no']").val());
		let fco_packaging = $("#footer_wrap div.cart_area_wrap ul.cart_area_items li input[name='fco_packaging']").val();
		let fc_menu_price = $("#footer_wrap div.cart_area_wrap ul.cart_area_items li input[name='fc_menu_price']").val();
		let totalPrice = fc_menu_price * fco_menu_cnt;
	}); */
	
}





</script>