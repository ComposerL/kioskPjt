<script th:fragment="js" type="text/javascript">
$(document).ready(function() {
    // 페이지가 로드되면 카테고리와 메뉴들을 가져오는 함수 호출
    ajax_getCategorie();
    orderBtnClick();
    ajax_get_AllOrder_by_order();
});

$('#order_btn').click(function() {
    // 클릭 이벤트 발생 시 실행되는 코드
    ajax_get_all_info();
    
});



//카테고리
function ajax_getCategorie() {
    console.log('ajax_getCategorie');

    $.ajax({
        url: '/franchisee/order/getCategory',
        method: 'get', // GET 요청으로 변경
        dataType: 'json',
        success: function(data) {
            console.log('cateajsx success!!')
            let cateDtos = data.categoryDtos;

            // 이전 카테고리 제거
            $('#order_category_select').empty();

            for (let i = 0; i < cateDtos.length; i++) {
                // 카테고리 옵션 추가
                $('#order_category_select').append(
                    '<option value="' + cateDtos[i].fcmc_no + '">' +
                    cateDtos[i].fcmc_name + '</option>');
            }
        },
        error: function(data) {
            console.log('CATEajax error!!');
        },
        complete: function(data){
        	console.log('CATEajax complate!!');
        	
        	ajax_get_order_by_category();
        	
        	// 카테고리가 변경될 때마다 해당 카테고리의 메뉴를 가져오는 함수 호출
        	$('#order_category_select').change(function() {
        		console.log("order_category_select change!!!!");
        	    // ajax_get_order_by_category($(this).val());
        	    ajax_get_order_by_category();
        	}); 
        }
    });
}

//메뉴
function ajax_get_order_by_category() {
    console.log('ajax_get_menus_by_category()');
    	
    let fcmc_no = $('#order_category_select').val();
    console.log('fcmc_no:>>>>>',fcmc_no);
    
    $.ajax({
        url: '/franchisee/order/getMenusByCategory',
        method: 'get',
        data: 'fcmc_no=' + fcmc_no, // 문자열 형태로 데이터 전달
        dataType: 'json',
        success: function(data) {
            console.log('menuajsx success!!');
            let menuDtos = data.franchiseeMenusDtos;
            let appendTag = '';

            $('#order_menu_select').empty();
                      
            	for (let i = 0; i < menuDtos.length; i++) {
                appendTag += '<option value="' + menuDtos[i].fc_menu_no + '">';
                appendTag += menuDtos[i].fc_menu_name;
                appendTag += '</option>';
            }

            $('#order_menu_select').html(appendTag);
            
          	                                                 
        },
        error: function(data) {
            console.log('ajax error!!');
        },
        complete: function(date) {
        	console.log('ajax complete');
        	console.log("fc_menu_no: ",$('#order_menu_select').val());
        	
        	ajax_get_price_by_category();
        	
        	$('#order_menu_select').change(function() {
        		console.log("order_menu_select change!!!!");
        		
        		
        		ajax_get_price_by_category();
        	}); 
        }
    });

}

// 돈 불러오기

function ajax_get_price_by_category() {
    console.log('ajax_get_price_by_category()');
    	
    let fc_menu_no = $('#order_menu_select').val();
    
    console.log('fc_menu_no:>>>>>',fc_menu_no);
    
    $.ajax({
        url: '/franchisee/order/getPriceByCategory',
        method: 'get',
        data: 'fc_menu_no=' + fc_menu_no, // 문자열 형태로 데이터 전달
        dataType: 'json',
        success: function(data) {
            console.log('pricejsx success!!');
            let priceDtos = data.franchiseePriceDtos;
            let appendTag = priceDtos[0].fc_menu_price;
                       
            $('.basic_price').val(appendTag);
                            			         	
        },
        error: function(data) {
            console.log('ajax error!!');
        },
    });

}


function orderBtnClick() {
    // "메뉴등록" 버튼 클릭 이벤트 핸들러
    $('#order_btn').click(function() {
        // 선택된 카테고리와 메뉴 가져오기
        let category = $('#order_category_select option:selected').text();
        
        let menu = $('#order_menu_select option:selected').text();
        // 주문 수량 가져오기
        let quantity = $('.basic_count').val();

        // 주문 가격 가져오기
        let price = $('.basic_price').val();

        // 주문 목록에 추가
        let appendTag = "<tr>";
	        	appendTag += '<td hidden></td>'
	        	appendTag += '<td>' + category + '</td>';
	        	appendTag += '<td>' + menu + '</td>';
	        	appendTag += '<td>' + quantity + '</td>';
	        	appendTag += '<td></td>';
	        	appendTag += '<td>' + new Date().toLocaleDateString() + '</td>'; // 현재 날짜를 주문일로 설정
	        	appendTag += '<td>' + new Date().toLocaleDateString() + '</td>'; // 현재 날짜를 수정일로 설정 (임시)
        	appendTag += '</tr>';
        	
        $("#order_table").append(appendTag);
        
        
    });
}

function ajax_get_AllOrder_by_order() {
	
		console.log('ajax_get_AllOrder_by_order()');
		let map = {};
		
	$.ajax({
		 url: '/franchisee/order/getAllOrderbyOrder',
	     method: 'get',
	     data: JSON.stringify(map),
	     dataType: 'json',	
	     success: function() {
	   	 console.log('menuajsx success!!');
	     let menuDtos = data.franchiseeMenusDtos; 
	      
	$("#AllOrder_btn").click(function(data) {
		
		console.log('AllOrder_btn clicked');
		
		for(let i = 1, j = 0 ; i <= $("#order_table tr").length;  i++, j++){
			
		     let category = $("#order_table tr:nth-child("+i+")td:nth-child(1)").text();
		     let menu = $("#order_table tr:nth-child("+i+")td:nth-child(2)").text();
		     let quantity = $("#order_table tr:nth-child("+i+")td:nth-child(3)").val();
		     let price = $("#order_table tr:nth-child("+i+")td:nth-child(4)").val();
		     
			     map[j] = {
			        "fcmc_no" : category,
		         	"fc_menu_no" : menu,
		         	"fco_menu_cnt" : quantity,
		         	"fc_menu_no" : menu,
		         
		     	}
		    		     
			}
		 console.log("map[0]: "+map[0]);
		 console.log("map[1]: "+map[1]);
		 console.log("map[2]: "+map[2]);
		 console.log("map[3]: "+map[3]);
		 console.log("map[4]: "+map[4]);
		
		});
	    	 
	},
	error: function(data) {
        console.log('ajax error!!');
	},
	
	
	
	});
		
}
                
</script>
